@using Bll.Models;
@using Domain.Models
@using Web.Controllers;
@model LotDetailsViewModel

@{
  ViewData["Title"] = Model.Name;
}

<div class="row g-3">

  @if(Model.Images != null && Model.Images.Count > 0)
  {
    <!-- Carousel of images -->
    <div id="images" class="carousel slide col-md-6 col-lg-5" data-bs-ride="carousel">
      <div class="carousel-inner sticky-md-top" style="top:1rem;">
        
        <div class="carousel-item active text-center">
          <img style="max-height:50vh;" src="@Model.Images.ElementAt(0)" alt="@Model.Name image">
        </div>
        
        @if(Model.Images.Count > 1)
        {
          @foreach(var image in Model.Images)
          {
            <div class="carousel-item">
              <img src="@image" class="d-block w-100" alt="@Model.Name image">
            </div>
          }
        }
      </div>
      
      @if (Model.Images.Count > 1)
      {
        <!-- Navigation -->
        <button class="carousel-control-prev" data-bs-target="#images" data-bs-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" data-bs-target="#images" data-bs-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Next</span>
        </button>
      }
    </div>
  }

  <div class="col">
        <h1>@Model.Name</h1>
        @if (@Model.IsClosed)
        {
              <small class=" pb-3">Lot was closed at: @Model.CloseTime.ToString()</small>
             <div class="row row-cols-2 mb-3">
             <p class="fw-bold">Sold with price: @Model.CurrentPrice $</p>
          <p class="">Start price: @Model.StartPrice $</p>
        </div>    
  
        }
        else
        {
           <small class=" pb-3">Will be closed on: @Model.CloseTime.ToString()</small>
            <div class="row row-cols-2 mb-3">
              <p class="fw-bold">Current price: @Model.CurrentPrice $</p>
              <p class="">Start price: @Model.StartPrice $</p>
            </div>  

         <form asp-action="@nameof(LotController.MakeBid)" asp-controller="@LotController.Name" method="post">
          <input type="hidden" value="@Model.Id" name="id" />
          <div class="input-group">
            <input type="number" class="form-control" name="amount" aria-label="Amount" aria-describedby="btn-make-bid" min="@Model.CurrentPrice" value="@(Model.CurrentPrice+1)" />
            <input type="submit" class="btn btn-primary" value="Make a bid" id="btn-make-bid" />
          </div>
        </form>
        }
  

    @if(Model.IsFavorite)
    {
      <a class="btn btn-sm btn-outline-secondary my-3" asp-controller="@FavoriteController.Name"
       asp-action="@nameof(FavoriteController.DeleteFavorite)" asp-route-id="@Model.Id" asp-route-redirect="@Model.Route">Remove from favorites</a>

    } else
    {
      <a class="btn btn-sm btn-outline-secondary  my-3" asp-controller="@FavoriteController.Name"
        asp-action="@nameof(FavoriteController.AddFavorite)" asp-route-id="@Model.Id" asp-route-redirect="@Model.Route">Add to favorites</a>
    }

    <h3 class="mt-3">Description:</h3>
    <p>@Model.Description</p>
  </div>
  <div>
      <h4 class="text-left my-4 pb-2">Bids:</h4>
<div>
    <ul class="list-group list-group-flush">
        @foreach (var order in @Model.Orders)
            {
                <li class="list-group-item">
                    @if (order.User!= null)
                    {
                        <p class="card-header">@order.User.UserName</p>
                    }
                    else
                    {
                        <p>User</p>
                    }
                <div>
                        <p class="card-text">@order.OrderPrice $</p>
                </div>
            </li>
            }
      </ul>
         

</div>

  </div>
</div>


